<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor SPED para Excel Moderno</title>
    <link rel="stylesheet" href="style.css">
    <!-- Consider adding a link to a font library if allowed, e.g., Google Fonts -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet"> -->
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <img src="images/logo-expertzy.png" alt="Expertzy Logo" class="logo-expertzy">
                <div class="header-text">
                    <h1>Conversor SPED para Excel <span class="title-version">Moderno</span></h1>
                    <p class="subtitle">Expertzy Intelig√™ncia Tribut√°ria</p>
                </div>
            </div>
        </header>

        <!-- Navega√ß√£o por Abas -->
        <div class="tab-navigation">
            <button id="tabConverter" class="tab-button active">Conversor SPED</button>
            <button id="tabFomentar" class="tab-button">Apura√ß√£o FOMENTAR</button>
            <button id="tabProgoias" class="tab-button">Apura√ß√£o ProGoi√°s</button>
        </div>

        <main class="main-content">
            <div id="converterPanel" class="converter-panel tab-content active">
                
                <div id="dropZone" class="drop-zone">
                    <span class="drop-zone-icon">üìÅ</span>
                    <p class="drop-zone-text">Arraste e solte o arquivo SPED aqui</p>
                    <p class="drop-zone-or">- ou -</p>
                    <label for="spedFile" class="btn-style btn-select-file">Selecionar Arquivo SPED</label>
                    <input type="file" id="spedFile" accept=".txt" style="display: none;">
                </div>
                
                <p id="selectedSpedFile" class="selected-file-text">Nenhum arquivo selecionado</p>

                <!-- **** START NEW LOG WINDOW HTML **** -->
                <div id="logContainer" class="log-container">
                    <h3 class="log-title">Log de Eventos</h3>
                    <div id="logWindow" class="log-window">
                        <!-- Log messages will be appended here by JavaScript -->
                    </div>
                </div>
                <!-- **** END NEW LOG WINDOW HTML **** -->

                <div class="output-section">
                    <label for="excelFileName" class="label-excel-output">Nome do arquivo Excel de sa√≠da:</label>
                    <input type="text" id="excelFileName" class="input-style input-excel-name" placeholder="NomeDoArquivoModerno.xlsx">
                </div>

                <div class="progress-section">
                    <div id="progressBarContainer" class="progress-bar-container-style">
                        <div id="progressBar" class="progress-bar-style" style="width: 0%;">0%</div>
                    </div>
                    <p id="statusMessage" class="status-message-text">Aguardando arquivo SPED...</p>
                </div>

                <button id="convertButton" class="btn-style btn-convert">
                    <span class="btn-icon">üöÄ</span> Converter Agora
                </button>
            </div>

            <!-- Painel FOMENTAR -->
            <div id="fomentarPanel" class="converter-panel tab-content">
                <div class="fomentar-header">
                    <h2>üìä Apura√ß√£o FOMENTAR/PRODUZIR/MICROPRODUZIR</h2>
                    <p class="fomentar-subtitle">Conforme Instru√ß√£o Normativa n¬∫ 885/07-GSF</p>
                </div>

                <div class="instrucoes-uso">
                    <h3>üìã Instru√ß√µes de Uso</h3>
                    <div class="instrucoes-content">
                        <p><strong>1. Importa√ß√£o do SPED:</strong> Clique em "Importar SPED" para carregar os dados fiscais do per√≠odo.</p>
                        <p><strong>2. Configura√ß√µes:</strong> Ajuste o programa (FOMENTAR/PRODUZIR/MICROPRODUZIR) e o percentual de financiamento.</p>
                        <p><strong>3. Verifica√ß√£o:</strong> <em>Revise os valores calculados automaticamente</em> e preencha campos edit√°veis conforme necess√°rio.</p>
                        <p><strong>4. Exporta√ß√£o:</strong> Gere o demonstrativo em Excel ou imprima diretamente.</p>
                    </div>
                </div>

                <div class="fomentar-import-section">
                    <div class="import-mode-selector">
                        <label>
                            <input type="radio" name="importMode" value="single" checked>
                            <span>Per√≠odo √önico</span>
                        </label>
                        <label>
                            <input type="radio" name="importMode" value="multiple">
                            <span>M√∫ltiplos Per√≠odos</span>
                        </label>
                    </div>
                    
                    <div id="singleImportSection" class="import-section">
                        <div id="fomentarDropZone" class="drop-zone">
                            <span class="drop-zone-icon">üìÅ</span>
                            <p class="drop-zone-text">Arraste e solte o arquivo SPED aqui</p>
                            <p class="drop-zone-or">- ou -</p>
                            <button id="importSpedFomentar" class="btn-style btn-import">
                                <span class="btn-icon">üìÇ</span> Importar SPED para FOMENTAR
                            </button>
                        </div>
                        <p id="fomentarSpedStatus">Nenhum arquivo SPED importado</p>
                    </div>
                    
                    <div id="multipleImportSection" class="import-section" style="display: none;">
                        <div id="multipleDropZone" class="multiple-import-zone">
                            <span class="drop-zone-icon">üìÅ</span>
                            <p>Arraste e solte m√∫ltiplos arquivos SPED aqui</p>
                            <p class="drop-zone-or">- ou -</p>
                            <input type="file" id="multipleSpedFiles" multiple accept=".txt" style="display: none;">
                            <button id="selectMultipleSpeds" class="btn-style btn-import">
                                <span class="btn-icon">üìÇ</span> Selecionar M√∫ltiplos SPEDs
                            </button>
                            <div id="multipleSpedsList" class="selected-files-list"></div>
                        </div>
                        <button id="processMultipleSpeds" class="btn-style btn-process" style="display: none;">
                            <span class="btn-icon">‚öôÔ∏è</span> Processar SPEDs em Sequ√™ncia
                        </button>
                    </div>
                </div>

                <div class="fomentar-config">
                    <h3>‚öôÔ∏è Configura√ß√µes da Apura√ß√£o</h3>
                    <div class="config-grid">
                        <div class="config-item">
                            <label for="programType">Programa de Incentivo:</label>
                            <select id="programType" class="input-style">
                                <option value="FOMENTAR">FOMENTAR (at√© 70%)</option>
                                <option value="PRODUZIR">PRODUZIR (at√© 73%)</option>
                                <option value="MICROPRODUZIR">MICROPRODUZIR (at√© 90%)</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label for="percentualFinanciamento">Percentual de Financiamento (%):</label>
                            <input type="number" id="percentualFinanciamento" class="input-style" 
                                   min="0" max="73" step="0.01" value="70.00">
                        </div>
                        <div class="config-item">
                            <label for="icmsPorMedia">ICMS por M√©dia (R$):</label>
                            <input type="number" id="icmsPorMedia" class="input-style" 
                                   step="0.01" value="0.00">
                        </div>
                        <div class="config-item">
                            <label for="saldoCredorAnterior">Saldo Credor Anterior (R$):</label>
                            <input type="number" id="saldoCredorAnterior" class="input-style" 
                                   step="0.01" value="0.00">
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o de Op√ß√£o para CFOPs Gen√©ricos -->
                <div id="cfopOpcaoSection" class="cfop-opcao-section" style="display: none;">
                    <h3>‚öôÔ∏è CFOPs Gen√©ricos Detectados</h3>
                    <p class="cfop-opcao-info">
                        Foram encontrados CFOPs gen√©ricos no SPED que podem ser utilizados para opera√ß√µes 
                        incentivadas ou n√£o incentivadas. <strong>Escolha uma op√ß√£o:</strong>
                    </p>
                    
                    <div class="cfop-opcao-actions">
                        <button id="btnListarCfops" class="btn-style btn-listar-cfops">
                            üìã Listar CFOPs Gen√©ricos
                        </button>
                        <button id="btnCalcularSemCfops" class="btn-style btn-calcular-sem-cfops">
                            üöÄ Calcular sem Corrigir CFOPs
                        </button>
                    </div>
                </div>

                <!-- Se√ß√£o de Configura√ß√£o de CFOPs Gen√©ricos -->
                <div id="cfopGenericoSection" class="cfop-generico-section" style="display: none;">
                    <h3>‚öôÔ∏è Configura√ß√£o de CFOPs Gen√©ricos</h3>
                    <p class="cfop-generico-info">
                        Configure individualmente cada ocorr√™ncia de CFOP gen√©rico encontrada no SPED:
                    </p>
                    
                    <div id="cfopsEncontrados" class="cfops-encontrados">
                        <!-- Ser√° preenchido dinamicamente via JavaScript -->
                    </div>
                    
                    <div class="cfop-actions">
                        <button id="btnAplicarCfops" class="btn-style btn-aplicar-cfops">
                            ‚úÖ Aplicar Configura√ß√µes
                        </button>
                        <button id="btnPularCfops" class="btn-style btn-pular-cfops">
                            ‚è≠Ô∏è Usar Configura√ß√£o Padr√£o
                        </button>
                    </div>
                </div>

                <!-- Se√ß√£o de Corre√ß√£o de C√≥digos E111 -->
                <div id="codigoCorrecaoSection" class="codigo-correcao-section" style="display: none;">
                    <h3>üîß Corre√ß√£o de C√≥digos de Ajuste E111</h3>
                    <p class="codigo-correcao-info">
                        C√≥digos de ajuste com erro no SPED podem ser corrigidos antes do c√°lculo.
                        <strong>Importante:</strong> Esta corre√ß√£o afeta a classifica√ß√£o entre incentivadas/n√£o incentivadas.
                    </p>
                    
                    <div id="codigosEncontrados" class="codigos-encontrados">
                        <!-- Ser√° preenchido dinamicamente via JavaScript -->
                    </div>
                    
                    <div class="correcao-actions">
                        <button id="btnAplicarCorrecoes" class="btn-style btn-aplicar-correcoes">
                            ‚úÖ Aplicar Corre√ß√µes e Calcular
                        </button>
                        <button id="btnPularCorrecoes" class="btn-style btn-pular-correcoes">
                            ‚è≠Ô∏è Pular Corre√ß√µes
                        </button>
                    </div>
                </div>

                <div id="fomentarResults" style="display: none;">
                    <div id="periodsSelector" class="periods-selector" style="display: none;">
                        <h3>üìÖ Per√≠odos Processados</h3>
                        <div id="periodsButtons" class="periods-buttons"></div>
                        <div class="view-options">
                            <button id="viewSinglePeriod" class="btn-style btn-small active">Vis√£o Individual</button>
                            <button id="viewComparative" class="btn-style btn-small">Vis√£o Comparativa</button>
                        </div>
                    </div>
                    <!-- Quadro A: Propor√ß√£o dos Cr√©ditos -->
                    <div class="quadro-section">
                        <h3>üìà QUADRO A - PROPOR√á√ÉO DOS CR√âDITOS APROPRIADOS</h3>
                        <div class="quadro-table">
                            <table class="fomentar-table">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Descri√ß√£o</th>
                                        <th>Valor (R$)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>1</td><td>Sa√≠das de Opera√ß√µes Incentivadas</td><td id="itemA1">0,00</td></tr>
                                    <tr><td>2</td><td>Total das Sa√≠das</td><td id="itemA2">0,00</td></tr>
                                    <tr><td>3</td><td>Percentual das Sa√≠das de Opera√ß√µes Incentivadas (%)</td><td id="itemA3">0,00</td></tr>
                                    <tr><td>4</td><td>Cr√©ditos por Entradas</td><td id="itemA4">0,00</td></tr>
                                    <tr><td>5</td><td>Outros Cr√©ditos</td><td id="itemA5">0,00</td></tr>
                                    <tr><td>6</td><td>Estorno de D√©bitos</td><td id="itemA6">0,00</td></tr>
                                    <tr><td>7</td><td>Saldo Credor do Per√≠odo Anterior</td><td id="itemA7">0,00</td></tr>
                                    <tr><td>8</td><td>Total dos Cr√©ditos do Per√≠odo</td><td id="itemA8">0,00</td></tr>
                                    <tr><td>9</td><td>Cr√©dito para Opera√ß√µes Incentivadas</td><td id="itemA9">0,00</td></tr>
                                    <tr><td>10</td><td>Cr√©dito para Opera√ß√µes N√£o Incentivadas</td><td id="itemA10">0,00</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Quadro B: Opera√ß√µes Incentivadas -->
                    <div class="quadro-section">
                        <h3>üéØ QUADRO B - APURA√á√ÉO DOS SALDOS DAS OPERA√á√ïES INCENTIVADAS</h3>
                        <div class="quadro-table">
                            <table class="fomentar-table">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Descri√ß√£o</th>
                                        <th>Valor (R$)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>11</td><td>D√©bito do ICMS das Opera√ß√µes Incentivadas</td><td id="itemB11">0,00</td></tr>
                                    <tr><td>12</td><td>Outros D√©bitos das Opera√ß√µes Incentivadas</td><td id="itemB12">0,00</td></tr>
                                    <tr><td>13</td><td>Estorno de Cr√©ditos das Opera√ß√µes Incentivadas</td><td id="itemB13">0,00</td></tr>
                                    <tr><td>14</td><td>Cr√©dito para Opera√ß√µes Incentivadas</td><td id="itemB14">0,00</td></tr>
                                    <tr><td>15</td><td>Dedu√ß√µes das Opera√ß√µes Incentivadas</td><td id="itemB15">0,00</td></tr>
                                    <tr><td>17</td><td>Saldo Devedor do ICMS das Opera√ß√µes Incentivadas</td><td id="itemB17">0,00</td></tr>
                                    <tr><td>18</td><td>ICMS por M√©dia</td><td id="itemB18">0,00</td></tr>
                                    <tr><td>21</td><td>ICMS Base para FOMENTAR/PRODUZIR</td><td id="itemB21">0,00</td></tr>
                                    <tr><td>22</td><td>Percentagem do Financiamento (%)</td><td id="itemB22">0,00</td></tr>
                                    <tr><td>23</td><td>ICMS Sujeito a Financiamento</td><td id="itemB23">0,00</td></tr>
                                    <tr><td>25</td><td>ICMS Financiado</td><td id="itemB25">0,00</td></tr>
                                    <tr><td>26</td><td>Saldo do ICMS da Parcela N√£o Financiada</td><td id="itemB26">0,00</td></tr>
                                    <tr><td>28</td><td>Saldo do ICMS a Pagar da Parcela N√£o Financiada</td><td id="itemB28">0,00</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Quadro C: Opera√ß√µes N√£o Incentivadas -->
                    <div class="quadro-section">
                        <h3>üìã QUADRO C - APURA√á√ÉO DOS SALDOS DAS OPERA√á√ïES N√ÉO INCENTIVADAS</h3>
                        <div class="quadro-table">
                            <table class="fomentar-table">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Descri√ß√£o</th>
                                        <th>Valor (R$)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>32</td><td>D√©bito do ICMS das Opera√ß√µes N√£o Incentivadas</td><td id="itemC32">0,00</td></tr>
                                    <tr><td>33</td><td>Outros D√©bitos das Opera√ß√µes N√£o Incentivadas</td><td id="itemC33">0,00</td></tr>
                                    <tr><td>34</td><td>Estorno de Cr√©ditos das Opera√ß√µes N√£o Incentivadas</td><td id="itemC34">0,00</td></tr>
                                    <tr><td>36</td><td>Cr√©dito para Opera√ß√µes N√£o Incentivadas</td><td id="itemC36">0,00</td></tr>
                                    <tr><td>37</td><td>Dedu√ß√µes das Opera√ß√µes N√£o Incentivadas</td><td id="itemC37">0,00</td></tr>
                                    <tr><td>39</td><td>Saldo Devedor do ICMS das Opera√ß√µes N√£o Incentivadas</td><td id="itemC39">0,00</td></tr>
                                    <tr><td>41</td><td>Saldo do ICMS a Pagar das Opera√ß√µes N√£o Incentivadas</td><td id="itemC41">0,00</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Resumo Final -->
                    <div class="resumo-section">
                        <h3>üí∞ RESUMO DA APURA√á√ÉO</h3>
                        <div class="resumo-grid">
                            <div class="resumo-item">
                                <label>Total a Pagar - Opera√ß√µes Incentivadas:</label>
                                <span id="totalPagarIncentivadas" class="valor-destaque">R$ 0,00</span>
                            </div>
                            <div class="resumo-item">
                                <label>Total a Pagar - Opera√ß√µes N√£o Incentivadas:</label>
                                <span id="totalPagarNaoIncentivadas" class="valor-destaque">R$ 0,00</span>
                            </div>
                            <div class="resumo-item">
                                <label>Valor do Financiamento FOMENTAR:</label>
                                <span id="valorFinanciamento" class="valor-destaque valor-economia">R$ 0,00</span>
                            </div>
                            <div class="resumo-item">
                                <label>Total Geral a Pagar:</label>
                                <span id="totalGeralPagar" class="valor-destaque valor-total">R$ 0,00</span>
                            </div>
                        </div>
                    </div>

                    <!-- A√ß√µes -->
                    <div class="fomentar-actions">
                        <button id="exportFomentar" class="btn-style btn-export">
                            <span class="btn-icon">üìä</span> Exportar Excel
                        </button>
                        <button id="exportFomentarMemoria" class="btn-style btn-export">
                            <span class="btn-icon">üîç</span> Exportar Mem√≥ria de C√°lculo
                        </button>
                        <button id="exportComparative" class="btn-style btn-export" style="display: none;">
                            <span class="btn-icon">üìà</span> Exportar Relat√≥rio Comparativo
                        </button>
                        <button id="exportPDF" class="btn-style btn-export" style="display: none;">
                            <span class="btn-icon">üìÑ</span> Exportar PDF Comparativo
                        </button>
                        <button id="printFomentar" class="btn-style btn-secondary">
                            <span class="btn-icon">üñ®Ô∏è</span> Imprimir
                        </button>
                    </div>
                </div>
            </div>

            <!-- Painel ProGoi√°s -->
            <div id="progoiasPanel" class="converter-panel tab-content">
                <div class="fomentar-header">
                    <h2>üèõÔ∏è Apura√ß√£o ProGoi√°s</h2>
                    <p class="fomentar-subtitle">Conforme Instru√ß√£o Normativa n¬∫ 1478/2020 e Decreto n¬∫ 9.724/2020</p>
                </div>

                <div class="instrucoes-uso">
                    <h3>üìã Instru√ß√µes de Uso</h3>
                    <div class="instrucoes-content">
                        <p><strong>1. Importa√ß√£o do SPED:</strong> Clique em "Importar SPED" para carregar os dados fiscais do per√≠odo.</p>
                        <p><strong>2. Configura√ß√µes:</strong> Ajuste os par√¢metros espec√≠ficos do ProGoi√°s conforme sua situa√ß√£o.</p>
                        <p><strong>3. Verifica√ß√£o:</strong> <em>Revise os valores calculados automaticamente</em> e preencha campos edit√°veis conforme necess√°rio.</p>
                        <p><strong>4. Exporta√ß√£o:</strong> Gere o demonstrativo em Excel ou imprima diretamente.</p>
                    </div>
                </div>

                <div class="fomentar-import-section">
                    <div class="import-mode-selector">
                        <label>
                            <input type="radio" name="importModeProgoias" value="single" checked>
                            <span>Per√≠odo √önico</span>
                        </label>
                        <label>
                            <input type="radio" name="importModeProgoias" value="multiple">
                            <span>M√∫ltiplos Per√≠odos</span>
                        </label>
                    </div>
                    
                    <div id="singleImportSectionProgoias" class="import-section">
                        <div id="progoiasDropZone" class="drop-zone">
                            <span class="drop-zone-icon">üìÅ</span>
                            <p class="drop-zone-text">Arraste e solte o arquivo SPED aqui</p>
                            <p class="drop-zone-or">- ou -</p>
                            <button id="importSpedProgoias" class="btn-style btn-import">
                                <span class="btn-icon">üìÇ</span> Importar SPED para ProGoi√°s
                            </button>
                        </div>
                        <p id="progoiasSpedStatus">Nenhum arquivo SPED importado</p>
                    </div>
                    
                    <div id="multipleImportSectionProgoias" class="import-section" style="display: none;">
                        <div id="multipleDropZoneProgoias" class="multiple-import-zone">
                            <span class="drop-zone-icon">üìÅ</span>
                            <p>Arraste e solte m√∫ltiplos arquivos SPED aqui</p>
                            <p class="drop-zone-or">- ou -</p>
                            <input type="file" id="multipleSpedFilesProgoias" multiple accept=".txt" style="display: none;">
                            <button id="selectMultipleSpedsProgoias" class="btn-style btn-import">
                                <span class="btn-icon">üìÇ</span> Selecionar M√∫ltiplos SPEDs
                            </button>
                            <div id="multipleSpedListProgoias" class="selected-files-list"></div>
                        </div>
                        
                        <!-- Configura√ß√µes espec√≠ficas para m√∫ltiplos per√≠odos -->
                        <div class="fomentar-config" id="progoiasMultipleConfig" style="display: none;">
                            <h3>‚öôÔ∏è Configura√ß√µes para M√∫ltiplos Per√≠odos ProGoi√°s</h3>
                            <div class="config-grid">
                                <div class="config-item">
                                    <label for="progoiasMultipleTipoEmpresa">Tipo de Empresa:</label>
                                    <select id="progoiasMultipleTipoEmpresa" class="input-style">
                                        <option value="">Selecione...</option>
                                        <option value="MICRO">Microempresa</option>
                                        <option value="PEQUENA">Empresa de Pequeno Porte</option>
                                        <option value="MEDIA">Empresa de M√©dio Porte</option>
                                        <option value="GRANDE">Empresa de Grande Porte</option>
                                    </select>
                                </div>
                                <div class="config-item">
                                    <label for="progoiasMultipleInicioFruicao">In√≠cio da Frui√ß√£o (M√™s/Ano):</label>
                                    <div style="display: flex; gap: 10px;">
                                        <select id="progoiasMultipleMesInicio" class="input-style" style="flex: 1;">
                                            <option value="">M√™s...</option>
                                            <option value="01">Janeiro</option>
                                            <option value="02">Fevereiro</option>
                                            <option value="03">Mar√ßo</option>
                                            <option value="04">Abril</option>
                                            <option value="05">Maio</option>
                                            <option value="06">Junho</option>
                                            <option value="07">Julho</option>
                                            <option value="08">Agosto</option>
                                            <option value="09">Setembro</option>
                                            <option value="10">Outubro</option>
                                            <option value="11">Novembro</option>
                                            <option value="12">Dezembro</option>
                                        </select>
                                        <input type="number" id="progoiasMultipleAnoInicio" class="input-style" 
                                               placeholder="2024" min="2020" max="2030" style="flex: 1;">
                                    </div>
                                    <small style="color: #666; font-size: 0.9em;">
                                        ‚ÑπÔ∏è Cada per√≠odo ser√° calculado automaticamente com base no tempo de frui√ß√£o
                                    </small>
                                </div>
                                <div class="config-item">
                                    <label for="progoiasMultipleIcmsPorMedia">ICMS por M√©dia (R$):</label>
                                    <input type="number" id="progoiasMultipleIcmsPorMedia" class="input-style" 
                                           step="0.01" value="0.00">
                                </div>
                                <div class="config-item">
                                    <label for="progoiasMultipleSaldoCredor">Saldo Credor Anterior - 1¬∫ Per√≠odo (R$):</label>
                                    <input type="number" id="progoiasMultipleSaldoCredor" class="input-style" 
                                           step="0.01" value="0.00">
                                </div>
                                <div class="config-item">
                                    <label for="progoiasMultipleAjustePeriodoAnterior">Ajuste Per√≠odo Anterior - 1¬∫ Per√≠odo (R$):</label>
                                    <input type="number" id="progoiasMultipleAjustePeriodoAnterior" class="input-style" 
                                           step="0.01" value="0.00">
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>

                <!-- Configura√ß√£o para per√≠odo √∫nico (s√≥ aparece quando necess√°rio) -->
                <div class="fomentar-config" id="progoiasSingleConfig" style="display: block;">
                    <h3>‚öôÔ∏è Configura√ß√µes da Apura√ß√£o ProGoi√°s - Per√≠odo √önico</h3>
                    <div class="config-grid">
                        <div class="config-item">
                            <label for="progoiasTipoEmpresa">Tipo de Empresa:</label>
                            <select id="progoiasTipoEmpresa" class="input-style">
                                <option value="">Selecione...</option>
                                <option value="MICRO">Microempresa</option>
                                <option value="PEQUENA">Empresa de Pequeno Porte</option>
                                <option value="MEDIA">Empresa de M√©dio Porte</option>
                                <option value="GRANDE">Empresa de Grande Porte</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label for="progoiasOpcaoCalculo">Op√ß√£o de C√°lculo:</label>
                            <select id="progoiasOpcaoCalculo" class="input-style">
                                <option value="">Selecione...</option>
                                <option value="ano">Informar Ano de Frui√ß√£o Atual</option>
                                <option value="manual">Informar Percentual Manualmente</option>
                            </select>
                        </div>
                        <div class="config-item" id="progoiasGrupoAno" style="display: none;">
                            <label for="progoiasAnoFruicao">Ano de Frui√ß√£o:</label>
                            <select id="progoiasAnoFruicao" class="input-style">
                                <option value="">Selecione...</option>
                                <option value="1">1¬∫ Ano (ProGoi√°s: 64% | PROTEGE: 10%)</option>
                                <option value="2">2¬∫ Ano (ProGoi√°s: 65% | PROTEGE: 8%)</option>
                                <option value="3">3¬∫ Ano+ (ProGoi√°s: 66% | PROTEGE: 6%)</option>
                            </select>
                        </div>
                        <div class="config-item" id="progoiasGrupoManual" style="display: none;">
                            <label for="progoiasPercentualManual">Percentual ProGoi√°s (%):</label>
                            <input type="number" id="progoiasPercentualManual" class="input-style" 
                                   step="0.01" min="0" max="100" placeholder="Digite o percentual">
                        </div>
                        <div class="config-item">
                            <label for="progoiasPercentualCalculado">Percentual Calculado:</label>
                            <input type="text" id="progoiasPercentualCalculado" class="input-style" 
                                   readonly placeholder="Ser√° calculado automaticamente" style="background-color: #f5f5f5;">
                        </div>
                        <div class="config-item">
                            <label for="progoiasIcmsPorMedia">ICMS por M√©dia (R$):</label>
                            <input type="number" id="progoiasIcmsPorMedia" class="input-style" 
                                   step="0.01" value="0.00">
                        </div>
                        <div class="config-item">
                            <label for="progoiasSaldoCredorAnterior">Saldo Credor Anterior (R$):</label>
                            <input type="number" id="progoiasSaldoCredorAnterior" class="input-style" 
                                   step="0.01" value="0.00">
                        </div>
                        <div class="config-item">
                            <label for="progoiasAjustePeriodoAnterior">Ajuste Per√≠odo Anterior (R$):</label>
                            <input type="number" id="progoiasAjustePeriodoAnterior" class="input-style" 
                                   step="0.01" value="0.00">
                        </div>
                    </div>
                </div>

                <div class="fomentar-process-section">
                        <button id="processProgoisData" class="btn-style btn-process" style="display: none;">
                            <span class="btn-icon">‚öôÔ∏è</span> Processar Apura√ß√£o ProGoi√°s
                        </button>
                        
                        <div id="progoiasProgressSection" class="progress-section" style="display: none;">
                            <div class="progress-bar-container-style">
                                <div id="progoiasProgressBar" class="progress-bar-style" style="width: 0%;">0%</div>
                            </div>
                            <p id="progoiasProgressMessage" class="status-message-text">Processando arquivos...</p>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o de Corre√ß√£o de C√≥digos E111 - ProGoi√°s -->
                <div id="progoiasCodigoCorrecaoSection" class="codigo-correcao-section" style="display: none;">
                    <h3>üîß Corre√ß√£o de C√≥digos de Ajuste E111 - ProGoi√°s</h3>
                    <p class="codigo-correcao-info">
                        C√≥digos de ajuste com erro no SPED podem ser corrigidos antes do c√°lculo ProGoi√°s.
                        <strong>Importante:</strong> Esta corre√ß√£o afeta a classifica√ß√£o entre opera√ß√µes incentivadas/n√£o incentivadas.
                    </p>
                    
                    <div id="progoiasCodigosEncontrados" class="codigos-encontrados">
                        <!-- Ser√° preenchido dinamicamente via JavaScript -->
                    </div>
                    
                    <div class="correcao-actions">
                        <button id="btnAplicarCorrecoesProgoias" class="btn-style btn-aplicar-correcoes">
                            ‚úÖ Aplicar Corre√ß√µes e Calcular ProGoi√°s
                        </button>
                        <button id="btnPularCorrecoesProgoias" class="btn-style btn-pular-correcoes">
                            ‚è≠Ô∏è Pular Corre√ß√µes
                        </button>
                    </div>
                </div>

                <div id="progoiasResults" style="display: none;">
                    <div id="progoiasPeriodsSelector" class="periods-selector" style="display: none;">
                        <h3>üìÖ Per√≠odos Processados</h3>
                        <div id="progoiasPeriodsButtons" class="periods-buttons"></div>
                        <div class="view-options">
                            <button id="progoiasViewSinglePeriod" class="btn-style btn-small active">Vis√£o Individual</button>
                            <button id="progoiasViewComparative" class="btn-style btn-small">Vis√£o Comparativa</button>
                        </div>
                    </div>

                    <!-- ABA 1: C√ÅLCULO DO PROGOI√ÅS -->
                    <div class="quadro-section">
                        <h3>üìã ABA 1 - C√ÅLCULO DO PROGOI√ÅS (Progoias.xlsx)</h3>
                        <div class="quadro-table">
                            <table class="fomentar-table">
                                <thead>
                                    <tr>
                                        <th>C√≥digo</th>
                                        <th>Descri√ß√£o</th>
                                        <th>Valor (R$)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>GO100002</td><td>ICMS Sa√≠das Incentivadas</td><td id="progoiasItemA01">0,00</td></tr>
                                    <tr><td>GO100003</td><td>ICMS Entradas Incentivadas</td><td id="progoiasItemA02">0,00</td></tr>
                                    <tr><td>GO100004</td><td>Outros Cr√©ditos (Anexo II)</td><td id="progoiasItemA03">0,00</td></tr>
                                    <tr><td>GO100005</td><td>Outros D√©bitos (Anexo II)</td><td id="progoiasItemA04">0,00</td></tr>
                                    <tr><td>GO100007</td><td>Ajuste Per√≠odo Anterior</td><td id="progoiasItemA05">0,00</td></tr>
                                    <tr><td>GO100006</td><td>M√©dia ICMS (se aplic√°vel)</td><td id="progoiasItemA06">0,00</td></tr>
                                    <tr><td>-</td><td><strong>Base de C√°lculo</strong></td><td id="progoiasItemA07" style="background: #e3f2fd; font-weight: bold;">0,00</td></tr>
                                    <tr><td>GO100001</td><td>Percentual ProGoi√°s (%)</td><td id="progoiasItemA08">0,00</td></tr>
                                    <tr><td>GO100009</td><td><strong>Cr√©dito Outorgado ProGoi√°s</strong></td><td id="progoiasItemA09" style="background: #c8e6c9; font-weight: bold;">0,00</td></tr>
                                    <tr><td>GO100008</td><td>Ajuste Pr√≥ximo Per√≠odo</td><td id="progoiasItemA10">0,00</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ABA 2: APURA√á√ÉO DO ICMS -->
                    <div class="quadro-section">
                        <h3>üìà ABA 2 - APURA√á√ÉO DO ICMS (Progoias.xlsx)</h3>
                        <div class="quadro-table">
                            <table class="fomentar-table">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Descri√ß√£o</th>
                                        <th>Valor (R$)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>01</td><td>D√©bito do ICMS</td><td id="progoiasItemB13">0,00</td></tr>
                                    <tr><td>02</td><td>Outros D√©bitos</td><td id="progoiasItemB14">0,00</td></tr>
                                    <tr><td>03</td><td>Estorno de Cr√©ditos</td><td id="progoiasItemB15">0,00</td></tr>
                                    <tr><td>04</td><td><strong>Total de D√©bitos</strong></td><td id="progoiasItemB16" style="background: #ffebee; font-weight: bold;">0,00</td></tr>
                                    <tr><td>05</td><td>Cr√©ditos por Entradas</td><td id="progoiasItemB17">0,00</td></tr>
                                    <tr><td>06</td><td>Outros Cr√©ditos</td><td id="progoiasItemB18">0,00</td></tr>
                                    <tr><td>09</td><td><strong>Cr√©dito ProGoi√°s</strong></td><td id="progoiasItemB19" style="background: #c8e6c9; font-weight: bold;">0,00</td></tr>
                                    <tr><td>-</td><td>Resumo ICMS</td><td colspan="2" style="background: #f5f5f5; text-align: center; font-style: italic;">Valores Finais</td></tr>
                                    <tr><td>13</td><td><strong>ICMS a Recolher</strong></td><td id="progoiasIcmsDevido" style="background: #fff3e0; font-weight: bold;">R$ 0,00</td></tr>
                                    <tr><td>14</td><td>PROTEGE</td><td id="progoiasValorProtege">R$ 0,00</td></tr>
                                    <tr><td>15</td><td><strong>ICMS Final</strong></td><td id="progoiasIcmsRecolher" style="background: #e8f5e8; font-weight: bold;">R$ 0,00</td></tr>
                                    <tr><td>-</td><td><strong>Economia Total</strong></td><td id="progoiasEconomiaTotal" style="background: #e3f2fd; font-weight: bold;">R$ 0,00</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- DEMONSTRATIVO DETALHADO -->
                    <div class="quadro-section">
                        <h3>üìä DEMONSTRATIVO DETALHADO - OPERA√á√ïES E ICMS</h3>
                        <div class="quadro-table">
                            <table class="fomentar-table">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Descri√ß√£o</th>
                                        <th>Valor (R$)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>18</td><td>Sa√≠das com Incentivo</td><td id="progoiasItemC18">0,00</td></tr>
                                    <tr><td>19</td><td>Sa√≠das sem Incentivo</td><td id="progoiasItemC19">0,00</td></tr>
                                    <tr><td>20</td><td>Total das Sa√≠das</td><td id="progoiasItemC20">0,00</td></tr>
                                    <tr><td>21</td><td>Entradas com Incentivo</td><td id="progoiasItemC21">0,00</td></tr>
                                    <tr><td>22</td><td>Entradas sem Incentivo</td><td id="progoiasItemC22">0,00</td></tr>
                                    <tr><td>23</td><td>Total das Entradas</td><td id="progoiasItemC23">0,00</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Resumo Final -->
                    <div class="resumo-section">
                        <h3>üí∞ RESUMO DA APURA√á√ÉO PROGOI√ÅS</h3>
                        <div class="resumo-grid">
                            <div class="resumo-item">
                                <label>ICMS Devido antes dos Incentivos:</label>
                                <span id="progoiasIcmsDevido" class="valor-destaque">R$ 0,00</span>
                            </div>
                            <div class="resumo-item">
                                <label>Valor do Incentivo ProGoi√°s:</label>
                                <span id="progoiasValorIncentivo" class="valor-destaque valor-economia">R$ 0,00</span>
                            </div>
                            <div class="resumo-item">
                                <label>Valor do PROTEGE:</label>
                                <span id="progoiasValorProtege" class="valor-destaque valor-economia">R$ 0,00</span>
                            </div>
                            <div class="resumo-item">
                                <label>ICMS a Recolher ap√≥s Incentivos:</label>
                                <span id="progoiasIcmsRecolher" class="valor-destaque">R$ 0,00</span>
                            </div>
                            <div class="resumo-item">
                                <label>Economia Fiscal Total:</label>
                                <span id="progoiasEconomiaTotal" class="valor-destaque valor-total">R$ 0,00</span>
                            </div>
                        </div>
                    </div>

                    <!-- A√ß√µes -->
                    <div class="fomentar-actions">
                        <button id="exportProgoias" class="btn-style btn-export">
                            <span class="btn-icon">üìä</span> Exportar Excel
                        </button>
                        <button id="exportProgoisMemoria" class="btn-style btn-export">
                            <span class="btn-icon">üîç</span> Exportar Mem√≥ria de C√°lculo
                        </button>
                        <button id="exportProgoisComparative" class="btn-style btn-export" style="display: none;">
                            <span class="btn-icon">üìà</span> Exportar Relat√≥rio Comparativo
                        </button>
                        <button id="exportProgoisPDF" class="btn-style btn-export" style="display: none;">
                            <span class="btn-icon">üìÑ</span> Exportar PDF Comparativo
                        </button>
                        <button id="printProgoias" class="btn-style btn-secondary">
                            <span class="btn-icon">üñ®Ô∏è</span> Imprimir
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <footer class="app-footer">
            <p>Conversor SPED Moderno &copy; 2024</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx-populate/browser/xlsx-populate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
